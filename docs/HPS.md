📚 HPS 语言完全参考手册

HermesProbability Science (HPS) v11.0 - 完整功能详解

---

第一部分：基础符号系统

1.1 标识符体系

@ - 主体标识符（玩家/执行者）

```hps
@1        ← 玩家1
@2        ← 玩家2  
@0        ← 所有玩家
@1-10     ← 玩家1到10
@新手     ← 新手玩家
@氪佬     ← 氪金玩家

{@1,100}  ← 玩家1执行100次操作
```

$ - 物品标识符（抽卡目标）

```hps
$1              ← 物品1
$2              ← 物品2
$0              ← 所有物品
$雷电,5星       ← 名为"雷电"且品质5星的物品
$甘雨,5星,冰    ← 带多个属性的物品
$1,$2,$3        ← 物品列表
```

# - 变量标识符（数字/状态）

```hps
#抽数 = 0           ← 定义变量
#五星计数            ← 统计变量
#($1=)              ← 物品1抽到的次数
#A($1=)             ← 存入变量A
(#A)                ← 引用变量A
```

¥ - 货币标识符（经济系统）

```hps
¥100        ← 100额度
¥R648       ← 648人民币
¥G10000     ← 10000游戏币
¥C3280      ← 3280结晶
¥F1600      ← 1600免费币
$¥          ← 所有货币总和
+¥1000      ← 增加额度
-¥160       ← 扣除额度
```

¢ - 元标识符（注释/输出/函数）

```hps
¢ 这是注释                      ← 注释
¢,输出文本                      ← 输出
¢,!警告信息                     ← 警告输出
¢,?调试信息                     ← 调试输出
¢.函数名()                      ← 函数定义
¢.End                           ← 函数结束
¢.Case 案例名                    ← 案例标记
¢L = ㏒(1.7/-97)                ← 结果变量
```

---

1.2 操作符系统

/ - 概率标记符

```hps
0.6/        ← 0.6%
1/          ← 1%
50/         ← 50%
100/        ← 100%
```

: - 重复符（时间维度）

```hps
0.1/:2      ← 连续抽2次
:10         ← 重复10次
×:10        ← 10连抽的方式
```

- - 并行符（空间维度）

```hps
0.1/:2-10   ← 10个人各连续抽2次
@1-10       ← 玩家1到10
-¥160       ← 扣除160额度
```

⇒ - 顺序符（因果/流程）

```hps
抽卡 ⇒ 扣钱                    ← 先抽卡再扣钱
?(条件) ⇒ 执行                  ← 如果条件成立则执行
?(条件) ⇒ A，否则 B             ← 条件分支
```

? - 条件符

```hps
?(#抽数 > 90)                  ← 如果抽数大于90
?($1=) ⇒ ¢,出货                ← 如果出货就输出
?($1=) ⇒ 停，否则 继续          ← 完整条件判断
```

= / ≠ - 状态符

```hps
($1=)      ← 物品1已抽到
($1≠)      ← 物品1未抽到
#($1=)     ← 抽到物品1的次数
```

& - 数学符

```hps
&A(1+2×3)        ← 1+2×3 = 7
&A(10÷2)         ← 10÷2 = 5
&A(2^10)         ← 2的10次方 = 1024
&A(㏒(100))      ← 以10为底的对数 = 2
```

! - 错误符

```hps
!语法错误                     ← 语法错误提示
!非法符号:（）                ← 指出错误位置
!变量未定义                   ← 语义错误提示
```

\ - 转义符

```hps
\$          ← 输出$符号而不是变量
\¥          ← 输出¥符号
\\          ← 输出一个反斜杠
```

---

1.3 括号系统

[] - 方括号（单品绑定）

```hps
[0.1/$1]           ← 物品1的概率是0.1%
[0.1/$1,5星]       ← 指定5星物品
[100/$1@90]        ← 90抽保底物品1
```

() - 圆括号（概率池）

```hps
(0.1/:$1,$2,$3)                ← 总概率0.1%的池子
(0.6/:$雷电,$甘雨)#角色UP       ← 命名池子
(1/:$1,$2,$3) + [100/$1@90]    ← 池子加保底
```

{} - 花括号（主体定义）

```hps
{@1,100}                      ← 玩家1执行100次
{@1-10,50}                    ← 10个玩家各50次
{@1, while 条件}               ← 带循环的主体
```

<> - 尖括号（目标声明/抽卡指令）

```hps
<$1,#A×:10,*90>               ← 目标声明
<#池子,:10>                   ← 从池子抽10连
<#A#B,:10>                    ← 同时抽两个池子
```

"" - 引号（储存库）

```hps
"#A,$A"                       ← 定义储存库
"#数据" ← 值                   ← 存入数据
"#数据".变量                   ← 读取数据
```

---

第二部分：概率表达系统

2.1 基础概率

```hps
0.6/      ← 0.6%
1/        ← 1%
50/       ← 50%
100/      ← 100%
```

2.2 科学计数法

```hps
1/-3      ← 1×10⁻³ = 0.001
1.7/-97   ← 1.7×10⁻⁹⁷
1/+80     ← 1×10⁸⁰ (宇宙原子总数)
```

2.3 复合科学计数法

```hps
1.7/1/-97     ← 1.7×1×10⁻⁹⁷ = 1.7×10⁻⁹⁷
2.5/3/+4      ← 2.5×3×10⁴ = 75000
```

2.4 概率池定义

```hps
(0.6/:$雷电,$甘雨,$胡桃)#角色UP
(0.7/:$和璞鸢,$贯虹,$护摩)#武器池
(0.1/:$1,$2,$3,$4,$5)#常驻池
```

---

第三部分：抽卡系统

3.1 目标声明（HPS 的灵魂）

```hps
<$目标物品, #池子 ×:抽卡方式, *保底数>

示例：
<$雷电,#角色UP×:10,*90>    ← 十连，90抽保底
<$甘雨,#角色UP×:1,*180>     ← 单抽，180抽保底
<$武器,#武器池×:10,*80>     ← 十连，80抽保底
```

3.2 保底机制

```hps
[100/$1@90]              ← 90抽硬保底
[0.6/$1 ^70 +2]          ← 70抽后每抽+2%软保底
[0.6/$1 ^70 ×1.5]        ← 70抽后概率乘1.5倍
```

3.3 抽卡指令

```hps
<#池子,:1>               ← 单抽
<#池子,:10>              ← 十连
<#A#B,:10>               ← 双池同抽
```

3.4 抽卡模拟

```hps
{@1,100} <#角色UP,:10>   ← 玩家1抽100次十连
```

---

第四部分：变量与赋值

4.1 基础赋值

```hps
#抽数 = 0
#概率 = 0.6/
#名字 = "雷电将军"
```

4.2 数学表达式赋值

```hps
#期望 = &A(1 ÷ 0.006)
#面积 = &A(π × 5^2)
#对数 = &A(㏒(1.7/-97))
```

4.3 货币赋值

```hps
#预算 = ¥64800
#单价 = ¥160
```

4.4 状态变量

```hps
#($1=)           ← 物品1抽到的次数
#A($1=) = 10     ← 存入变量A
(#A)             ← 引用变量A
```

---

第五部分：数学运算系统

5.1 基础运算

```hps
&A(1 + 2)        ← 3
&A(3 × 4)        ← 12
&A(10 ÷ 2)       ← 5
&A(2^10)         ← 1024
```

5.2 数学常数

```hps
π     ← 3.14159...
e     ← 2.71828...
φ     ← 1.61803...
√2    ← 1.41421...
```

5.3 数学函数

函数 含义 示例
㏒() 以10为底对数 ㏒(100)=2
㏑() 自然对数 ㏑(e)=1
√() 平方根 √(9)=3
sin() 正弦 sin(π/2)=1
cos() 余弦 cos(0)=1
exp() e的x次方 exp(1)=e

5.4 统计函数

```hps
&A(avg(1,2,3))     ← 平均值 = 2
&A(var(1,2,3))     ← 方差
&A(std(1,2,3))     ← 标准差
&A(max(1,2,3))     ← 最大值 = 3
&A(min(1,2,3))     ← 最小值 = 1
```

5.5 精度控制

```hps
π:5          ← 3.14159
1.7/-97:3    ← 1.700×10⁻⁹⁷
```

---

第六部分：流程控制

6.1 条件判断

基础条件

```hps
?(#抽数 > 70) ⇒ ¢,软保底触发
```

条件分支

```hps
?($1=) ⇒ ¢,出货了！，否则 ¢,继续努力
```

复合条件

```hps
?(#抽数 > 70 & $1≠) ⇒ ¢,快保底了还没出
?(#抽数 = 90 | $1=) ⇒ 停
```

状态判断

```hps
?($1=) ⇒ 停                ← 如果抽到了
?($1≠) ⇒ 继续              ← 如果没抽到
?(#($1=) > 5) ⇒ ¢,抽到5次了
```

---

6.2 循环系统

while 循环

```hps
while (¥ ≥ 160) {
  <#池子,:1> ⇒ -¥160
  #抽数++
}
```

for 循环

```hps
for #i = 1 to 90 {
  <#池子,:1>
  ?($1=) ⇒ break
}

for #玩家 = 1 to 10 {
  for #抽 = 1 to 100 {
    {@#玩家,1} [0.006/$任意]
  }
}
```

until 循环

```hps
until ($1=) {
  <#池子,:1>
  #抽数++
}
```

循环控制

```hps
for #i = 1 to 180 {
  <#池子,:1>
  ?($1=) ⇒ break        ← 跳出循环
  ?(#i < 50) ⇒ continue  ← 跳过本次
}
```

---

6.3 特殊循环：记录循环 #¢{}±

基础用法

```hps
#¢{<抽卡操作>}± (1000)
```

完整格式

```hps
#¢{(@1,100) | [0.006/$任意,5星]}± (1000)
```

带条件控制

```hps
#¢{抽卡}± (100)
  #¢=,5,-    ← 成功5次就结束
  #¢-,0,+    ← 没有失败就继续
```

结果变量

```hps
#¢.success    ← 成功次数
#¢.total      ← 总次数  
#¢.rate       ← 成功率
#¢.fail       ← 失败次数
```

---

第七部分：函数系统

7.1 函数定义

无参函数

```hps
¢.打招呼()
  ¢,你好，HPS！
¢.End

调用：打招呼()
```

带参函数

```hps
¢.欢迎(玩家)
  ¢,欢迎 @玩家 来到抽卡世界！
¢.End

调用：欢迎(@1)
```

多参数函数

```hps
¢.抽卡报告(玩家,抽数,物品)
  ¢,【抽卡报告】
  ¢,  玩家：@玩家
  ¢,  抽数：#抽数
  ¢,  结果：?($物品=) ⇒ "出货" 否则 "没出"
¢.End
```

---

7.2 返回值函数

单返回值

```hps
¢.期望(概率)
  return &A(1 ÷ 概率)
¢.End

#雷神期望 = 期望(0.006)
```

多返回值

```hps
¢.抽卡统计(抽数,概率)
  #期望 = &A(抽数 × 概率)
  #方差 = &A(抽数 × 概率 × (1-概率))
  #标准差 = &A(√(#方差))
  
  return {
    期望: #期望,
    方差: #方差,
    标准差: #标准差
  }
¢.End

#结果 = 抽卡统计(100, 0.006)
¢,期望五星：#结果.期望
```

---

7.3 递归函数

递归保底

```hps
¢.递归保底(目标,当前抽数,保底阈值)
  ?(当前抽数) ≥ 保底阈值 ⇒
    return 保底阈值
  
  [0.006/目标]
  
  ?(目标=) ⇒
    return 当前抽数
  ，否则
    return 递归保底(目标, 当前抽数+1, 保底阈值)
¢.End

#实际抽数 = 递归保底($雷电, 1, 90)
```

递归树生成

```hps
¢.生成树枝(x,y,角度,深度)
  ?(深度 = 0) ⇒ return
  
  #终点X = x + cos(角度) × 长度
  #终点Y = y - sin(角度) × 长度
  
  画线(x,y,终点X,终点Y)
  
  生成树枝(终点X,终点Y, 角度+0.3, 深度-1)
  生成树枝(终点X,终点Y, 角度-0.3, 深度-1)
¢.End
```

---

7.4 函数库

概率库

```hps
¢.概率库
  ¢.二项分布(n,k,p)
    return &A( C(n,k) × p^k × (1-p)^(n-k) )
  ¢.End
  
  ¢.几何分布(p,k)
    return &A( (1-p)^(k-1) × p )
  ¢.End
  
  ¢.泊松分布(λ,k)
    return &A( e^(-λ) × λ^k ÷ k! )
  ¢.End
¢.End

调用：概率库.二项分布(100,5,0.006)
```

统计库

```hps
¢.统计库
  ¢.均值(列表) ⇒ &A(∑列表 ÷ 长度)
  ¢.方差(列表) ⇒ &A(∑(x-均值)² ÷ 长度)
  ¢.标准差(列表) ⇒ √(方差)
¢.End
```

---

第八部分：经济系统

8.1 货币定义

```hps
#预算 = ¥64800
#单价 = ¥160
#余额 = ¥1000
```

8.2 货币运算

```hps
#剩余 = &A(#预算 - #单价 × #抽数)
#可抽次数 = &A(#预算 ÷ #单价)
```

8.3 货币转换

```hps
¥R648 → ¥C6480    ← 648人民币换6480结晶
¥C6480 → ¥F12960  ← 结晶双倍换免费币
```

8.4 经济模拟

```hps
#预算 = ¥40000
while (#预算 ≥ 160) & ($1≠) {
  <#池子,:1> ⇒ -¥160
  #抽数++
}
¢,剩余：¥#预算
```

---

第九部分：储存库系统

9.1 定义储存库

```hps
"#历史数据,$1" ← 空
"玩家数据,@1" ← {}
```

9.2 存入数据

```hps
#¢实验{抽卡}± (1000)
"#历史数据,$1" ← #¢.成功
```

9.3 读取数据

```hps
#成功次数 = "#历史数据,$1".#历史数据
```

9.4 清空储存库

```hps
"#历史数据,$1".清空()
```

---

第十部分：错误处理与调试

10.1 错误提示

```hps
!语法错误: 缺少 ]
!非法符号: （） (请使用英文括号)
!变量 #抽数 未定义
```

10.2 调试输出

```hps
¢,! 警告：预算不足
¢,? 当前抽数：#抽数
¢,? 循环进度：50%
```

10.3 状态查看

```hps
/state    ← 查看所有变量和状态
/stats    ← 查看统计信息
/clear    ← 清空所有变量
```

---

第十一部分：完整示例

11.1 原神抽卡模拟器

```hps
¢==================================
¢ 原神角色UP池抽卡模拟器
¢==================================

¢ 1. 定义池子
(0.6/:$雷电,$甘雨,$胡桃)#角色UP

¢ 2. 定义目标
#目标 = $雷电

¢ 3. 初始化
预算 = ¥40000
单价 = ¥160
抽数 = 0
保底计数 = 0

¢ 4. 抽卡循环
while (预算 ≥ 单价) & (#目标≠) {
  <#角色UP,:1> ⇒ -¥160 ⇒ 抽数++ ⇒ 保底计数++
  
  ?(保底计数) > 70 ⇒ 
    ¢($任意,5星, ¢0.6 + (保底计数-70)×2)
  
  ?(保底计数) = 90 ⇒
    ¢(#目标, ¢100)
  
  ?($任意,5星=) ⇒ 
    ?($雷电=) ⇒ ¢,🎉出货！停
    ，否则 保底计数 = 0
}

¢ 5. 结果统计
¢,【抽卡报告】
¢,总抽数：#抽数
¢,总花费：¥(抽数 × 单价)
¢,剩余预算：¥预算
```

11.2 批量实验

```hps
¢==================================
¢ 大数定律验证
¢==================================

(0.6/:$五星)#池子

¢ 小样本实验
#¢{<$五星,#池子×:100,*100>}± (10)
¢,10次实验成功率：#¢.rate%

¢ 大样本实验
#¢{<$五星,#池子×:100,*100>}± (1000)
¢,1000次实验成功率：#¢.rate%

¢ 理论值
#理论 = 0.6%
¢,理论概率：#理论
```

11.3 函数库示例

```hps
¢==================================
¢ 概率函数库
¢==================================

¢.期望(概率)
  return &A(1 ÷ 概率)
¢.End

¢.置信区间(样本,置信度)
  #n = 长度(样本)
  #p = avg(样本)
  #z = ?置信度 = 0.95 ⇒ 1.96
  #误差 = #z × √(#p × (1-#p) ÷ #n)
  return [#p - #误差, #p + #误差]
¢.End

¢ 使用示例
#数据 = #¢{抽卡}± (1000)
#ci = 置信区间(#数据, 0.95)
¢,95%置信区间：[#ci.0, #ci.1]
```

---

第十二部分：HPS 哲学

```hps
【核心哲学】
数值随意，标签为王

数字本身不重要
重要的是如何标记它
如何理解它
如何运算它

【设计理念】
极简：每个符号只有一种含义
直观：符号形状关联含义
面向玩家：从“我想要什么”出发
可扩展：从简单到复杂自然进化

【终极目标】
让概率变得可计算
让随机变得可理解
让不确定变得可表达
```

---

HPS v11.0 - 由 RE-CAT 创造，从 1.7e-97 开始，到无限可能 🚀